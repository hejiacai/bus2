<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no,minimal-ui">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>我的订单</title>
  
  <link rel="stylesheet" type="text/css" href="../css/api.css"/>
  <link rel="stylesheet" type="text/css" href="../css/aui.2.0.css" />
  <link rel="stylesheet" type="text/css" href="../css/common.css"/>
  <link rel="stylesheet" type="text/css" href="../css/my_order.css" />
  <script>
        var deviceWidth = document.documentElement.clientWidth;
       if(deviceWidth > 750) {
           deviceWidth = 750;
       }
       document.documentElement.style.fontSize = deviceWidth / 7.5 + 'px';
  </script>
  <style>
  		.model{
  				display: inline-block;
  				width: 100%;
  				overflow: hidden;
  				text-overflow: ellipsis;
  				white-space: nowrap;
  		}
  		.adree{
  			width: 100%;
  			overflow:hidden; 
				text-overflow:ellipsis;
				display:-webkit-box; 
				-webkit-box-orient:vertical;
				-webkit-line-clamp:2; 
  		}
  		.wait_order_conment_detail{
  				width: 65%;
  		}
  </style>
</head>
<body>
  	<!--<div class="hd">
     	<img src="../image/2_03_03.png" alt="">我的订单
  	</div>-->
  	<section class="hot-class-sec">
  		<div class="aui-tab" id='tab'>
  			<div class="aui-tab-item aui-active" data-item-order='0'>
  				待发货
  			</div>
  			<div class="aui-tab-item " data-item-order='1'>
  				待确认
  			</div>
  			<div class="aui-tab-item " data-item-order='2'>
  				待评论
  			</div>
  		</div>
  		<div class="class-tab-ct" id='box_o'>
  			<script id="text" type="text/html">
		  			<div class="class-tab-ct-item">
		  				{{each list list_one index}}
		  				<div class="wait_order" data-id='{{list_one.id}}'>
		  					<div class="wait_order_header">
		  						<span class="sj">{{list_one.paytime}}</span>
		  						<span class="send">待发货</span>
		  					</div>
		  					<div class="wait_order_conment">
		  						<img src="{{list_one.goods_data.cover}}" alt="" />
		  						<div class="wait_order_conment_detail">
		  							<p class="model">{{list_one.goods_data.goods_name}}</p>
		  							<p class="adree">{{list_one.goods_data.desc}}</p>
		  							<p class="pay">
		  								<span class="yuan">￥{{list_one.goods_data.integral}}</span>
		  								<span class="coumt">共计{{list_one.goods_num}}件应付:  ￥{{list_one.integral}}</span>
		  							</p>
		  						</div>
		  					</div>
		  				</div>
		  				{{/each}}
		  			</div>
		  			<div class="class-tab-ct-item" style="display: none;">
		  				{{each list1 list_tow index}}
		  				<div class="wait_order box_t">
		  					<div class="wait_order_header">
		  						<span class="sj">{{list_tow.paytime}}</span>
		  					</div>
		  					<div class="wait_order_conment">
		  						<img src="{{list_tow.goods_data.cover}}" alt="" />
		  						<div class="wait_order_conment_detail">
		  							<p class="model">{{list_tow.goods_data.goods_name}}</p>
		  							<p class="adree">{{list_tow.goods_data.desc}}</p>
		  							<p class="pay">
		  								<span class="yuan">￥{{list_tow.goods_data.integral}}</span>
		  								<span class="coumt">共计{{list_tow.goods_num}}件应付:  ￥{{list_tow.integral}}</span>
		  							</p>
		  							<div class="but_n">
		  								  <button class="yfh">已发货</button>
		  								  <button class="qrfh" onclick="qrfh({{list_tow.ordernum}})">确认收货</button>
		  							</div>
		  						</div>
		  					</div>
		  				</div>
		  				{{/each}}
		  			</div>
		  			<div class="class-tab-ct-item" style="display: none;">
		  				{{each list2 list_tree index}}
		  				<div class="wait_order box_tr">
		  					<div class="wait_order_header">
		  						<span class="sj">{{list_tree.paytime}}</span>
		  					</div>
		  					<div class="wait_order_conment">
		  						<img src="{{list_tree.goods_data.cover}}" alt="" />
		  						<div class="wait_order_conment_detail">
		  							<p class="model">{{list_tree.goods_data.goods_name}}</p>
		  							<p class="adree">{{list_tree.goods_data.desc}}</p>
		  							<p class="pay">
		  								<span class="yuan">￥{{list_tree.goods_data.integral}}</span>
		  								<span class="coumt">共计{{list_tree.goods_num}}件应付:  ￥{{list_tree.integral}}</span>
		  							</p>
		  							<div class=" bun_o">
		  								  <button class="qrfh" onclick="order_comment({{list_tree}})">立即评论</button>
		  							</div>
		  						</div>
		  					</div>
		  				</div>
		  				{{/each}}
		  			</div>
  			</script>
  		</div>
  	</section>
</body>
 <script type="text/javascript" src="../script/jquery-3.3.1.min.js"></script>
 <script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/aui-tab.js" ></script>
<script type="text/javascript" src="../script/aui-slide.js"></script>
<script type="text/javascript" src="../script/aui-dialog.js"></script>
<script type="text/javascript" src="../script/swiper-3.4.2.jquery.min.js"></script>
<script type="text/javascript" src="../script/art-template.js" ></script>
<script type="text/javascript" src="../script/api.js"></script>
<script src="../script/mui.min.js"></script>
<script type="text/javascript" src="../script/jquery-3.3.1.min.js" ></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript">
    $('.aui-tab-item').click(function(){
		    var index1 = $(this).index();
		    $(this).addClass('aui-active').siblings().removeClass('aui-active');
		    $('.class-tab-ct .class-tab-ct-item').eq(index1).show().siblings().hide()
		})
        
        function GetRequest() {  
					   var url = location.search; //获取url中"?"符后的字串  
					   var theRequest = new Object();  
					   if (url.indexOf("?") != -1) {  
					      var str = url.substr(1);  
					      strs = str.split("&");  
					      for(var i = 0; i < strs.length; i ++) {  
					         theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1]);  
					      }  
					   }  
					   return theRequest; 
				}
			 var token=GetRequest('token');
						$.ajax({
               type: "POST",
               url: "http://bus.liebianzhe.com/api/order/order_list",
               data: {'token':token.token,}, 	
               success: function(data){
                        console.log(data);
                        if(data.code==1){
                        	var html1 = template('text', data.data);
                        	document.getElementById('box_o').innerHTML = html1;
                        }


                 }
           })
			function qrfh(ordernum){
					$.ajax({
						type:"post",
						url:"http://bus.liebianzhe.com/api/order/operation_order",
						async:true,
						data:{
							token:token.token,
							type:1,
							ordernum:ordernum
						},
						success:function(data){
							console.info(data);
							if(data.code==1){
									window.location.reload();
							}else{
									console.info(data.msg)
							}
						},
						error:function(){
								console.info("请求失败~");
						}
					});
			}
						
			function order_comment(order_data){
					console.info(order_data);
					var u = navigator.userAgent, app = navigator.appVersion;
	        var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //android终端或者uc浏览器
	        var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);
	        if (isAndroid) {
	        		
	            js.order_comment(JSON.stringify(order_data));
	        }
	        if (isiOS) {
	            window.webkit.messageHandlers.order_comment.postMessage(order_data);
	        }
			}
</script>
</html>
